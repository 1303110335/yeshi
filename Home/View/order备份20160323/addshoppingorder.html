<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>确认订单</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta content="telephone=yes" name="format-detection" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="stylesheet" href="__CSS__/css1.css">
<link rel="stylesheet" href="__CSS__/swiper.min.css">
<link rel="stylesheet" href="__CSS__/iconfont1/iconfont1.css">
<link rel="stylesheet" href="__CSS__/iconfont2/iconfont2.css">
<link rel="stylesheet" href="__CSS__/iconfont/iconfont.css">
<style>
.zhifu{
	display: block;
    background: #d12227;
    line-height: 45px;
    text-align: center;
    border-radius: 5px;
    margin-top: 20px;
    font-size: 16px;
    color: #fff;
	width:100%;
	border:none;
	}
.sccg{
	width:120px;
	height:80px;
	background:rgba(0,0,0,0.8);
	position:fixed;
	top:50%;
	left:50%;
	margin-top:-40px;
	margin-left:-60px;
	border-radius:10px;
	-moz-border-radius:10px;
	-webkit-border-radius:10px;
	-o-border-radius:10px;
	display:none;
	}
.sccgtb{
	width:25px;
	height:25px;
	margin-top:15px;
	color:#F29200;
	}
.sccg p{
	text-align:center;
	color:#ccc;
	margin-top:5px;
	}
</style>
</head>
<body id="scroll_top">
<div id="jiazai" style=" background:rgba(255,255,255,0.3);width:100%;height:100%; position:fixed; z-index:99999999999999999999999;display:none"></div>
<input type="hidden" value="{$allweight}" id="yunfei2">
<input type="hidden" value="{$newprice2}" id="newprice_2">
<!-- top --> 
<div style="display:n" id="container"></div>
<!-- top --> 
<!-- main_div -->
<form action="{:U('Order/orderadd_shop')}" method="post"  id="theForm">
<div class="main_div" style=" background:#f1f1f2; padding-bottom:100px">
  <div class="qrzf">
    <div class="qrzf_dz">
      <div class="qrzf_dz_left">
        <h1>送至<span>{$addressdetail.consignee}&nbsp;&nbsp;{$addressdetail.telephone}</span></h1>
        <p>{$addressdetail.province} {$addressdetail.city} {$addressdetail.country} {$addressdetail.xiangqing}</p>
      </div>
      <input name="consignee" type="hidden" value="{$addressdetail.consignee}">
      <input name="telephone" type="hidden" value="{$addressdetail.telephone}">
      <input name="country" type="hidden" value="中国">
      <input name="province" type="hidden" value="{$addressdetail.province}">
      <input name="city" type="hidden" value="{$addressdetail.city}">
      <input name="district" type="hidden" value="{$addressdetail.country}">
      <input name="address" type="hidden" value="{$addressdetail.xiangqing}">
      <input name="dealerNum" id="dealerNum" type="hidden" value="no">
<!--      <div class="qrzf_dz_right">
        <p>家庭</p>
      </div>-->
    </div>
    <div class="clear"></div>
  </div>
<foreach name="goodsdetail" item="vo">
  <div class="qrzf">
    <div class="qrzf_cp">
      <div class="qrzf_cp_left"> <img src="{$vo.pic}" width="100%"> </div>
      <div class="qrzf_cp_right">
        <h1>{$vo.good_name}</h1>
        <p style="margin-top:5px;">规格：{$vo.guige}</p>
        <p>数量：<font id="num{$vo.id}">{$vo.num}</font> <span class="shuliang">￥ {$vo.price}</span><span class="damwei">/件</span></p>
        <p>小计：<span class="shuliang">￥ <font id="total_price{$vo.id}">{$vo.total_price}</font></span></p>
      </div>
    </div>
    <div class="clear"></div>
  </div>
  <!--<div class="qrzf_sl">
  <div class="qrzf_sl_xz">
      <ul>
        <li>
          <div class="qrzf_sl_xzs" onClick="jian({$vo.id})"> - </div>
        </li>
        <li>
          <div class="qrzf_sl_xzs" style=" border:none; background:#fff;">
            <p>
              <input class="xdsl" readonly name="nums{$vo.id}" id="nums{$vo.id}" onChange="cha({$vo.id})" type="text" value="{$vo.num}">
              件</p>
            <div class="clear"></div>
          </div>
        </li>
        <li>
          <div class="qrzf_sl_xzs" style="display:none;" onClick="jia({$vo.id})"> + </div>
        </li>
      </ul>
      <div class="clear"></div>
    </div>
    </div>-->
</foreach>
  <div class="qrzf_sl">
    
    
    <div class="qrzf_sl_jg">
<foreach name="goodsdetail" item="vo">
    <input name="price{$vo.id}" id="price{$vo.id}" type="hidden" value="{$vo.price}">
    <input name="priceall{$vo.id}" id="priceall{$vo.id}" type="hidden" value="{$vo.total_price}">
    <input name="goodsid{$vo.id}" id="goodsid{$vo.id}" type="hidden" value="{$vo.goodsid}">
    <input name="pic{$vo.id}" id="pic{$vo.id}" type="hidden" value="{$vo.pic}">
    <input name="guige{$vo.id}" id="guige{$vo.id}" type="hidden" value="{$vo.guige}">
    <input name="nums{$vo.id}" id="nums{$vo.id}" type="hidden" value="{$vo.num}">
    <input name="d_price{$vo.id}" id="d_price{$vo.id}" type="hidden" value="{$vo.price}">
    <input name="good_name{$vo.id}" id="good_name{$vo.id}" type="hidden" value="{$vo.good_name}">
</foreach>
    <input name="goodid" id="goodid" type="hidden" value="{$ids}">
    <input name="total" id="total" type="hidden" value="{$to_price}">

    </div>
    <div class="qrzf_sl_jg">
    <div class="user_yhq">
            <div class="user_yhq2">
                <!-- user_yhq2_js -->
                <select id="demo2">
                  <option value="0">无</option>
                <volist name="coupon" id="vo">
                  <option value="{$vo.id}">{$vo.title}:{$vo.price}元</option>
                </volist>
                </select>
                <!-- user_yhq2_js -->
            </div>
            <div class="user_yhq1">使用优惠券：</div>
            <div class="clear"></div>
        </div>
      <input type="hidden" name="shipping_fee" id="shipping_fee" value="{$zongyunfei}">
        <input type="hidden" id="newprice2" value="{$to_price}">
        <input type="hidden" id="newprice" value="{$zprice}">
      <p>快递：¥<span id="yunfei" style="font-size:10px;color:#8A8A8A;">{$zongyunfei}</span> 需付款：<span>¥<font id="showmoney">{$zprice}</font></span></p>
    </div>
    
    <div class="clear"></div>
  </div>
  <div class="qrzf_zf">
    <h1>请选择支付方式</h1>
    <div class="clear"></div>
    <div class="qrzf_fs">
      <div class="qrzf_fsnav">
        <ul>
          <li style=" border-bottom: #e4e4e4 1px solid;">
            <h1><span class="iconfont" style=" color:#00cf0d;"><img style="vertical-align:middle;text-align:position;" src="__IMAGES__/iconfont-weizhifu.svg" width="23"></span>微信支付</h1>
          </li>
          <li>
            <input type="text" placeholder="填写订单备注" name="content" style=" line-height:50px; font-size:14px; padding-left: 5%; color: #b2b0b0;width:100%; border:none;">
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="qrzf_zf">
    <h1>是否上门店提货</h1>
    <div class="clear"></div>
    <div class="qrzf_fs">
      <div class="qrzf_fsnav">
        <ul>
          <li style=" border-bottom: #e4e4e4 1px solid;">
            <div class="dzform">
              <label>
                <input class="fdan" type="radio" name="RadioGroup1" value="1" id="RadioGroup1_0">
                是</label>
              <label>
                <input class="fdan1" type="radio" name="RadioGroup1" value="0" id="RadioGroup1_1" checked>
                否</label>
              <br>
            </div>
            <div class="clear"></div>
          </li>
          <div class="one">
            <div class="one1">选择自提门店</div>
          </div>
          <!--dianpu-->
          <div class="two two1" style="height:auto">
<foreach name="store" item="vo">
            <div class="twobox overflowH1">
                    <div class="two_img">
                        <img src="{$vo.pic}" width="100%" style=" width:100%;">
                    </div>
                    <div class="two_textbox">
                          <p class="two_text"><span>店铺名：</span>{$vo.storename}<br>
                          <span>地址：</span>{$vo.address}<br>
                          <span>营业时间：</span>{$vo.opentime}<br>
                          <span>联系电话：</span>{$vo.telephone}</p>
                    </div>
                    <input type="radio" name="storeid" value="{$vo.id}" style="visibility:hidden;">
                    </div>
</foreach>
          </div>
          <!--dianpu-->
          
          <li><a style=" background:#d12227" href="javascript:;" class='zhifu' >立即支付</a></li>
        </ul>
      </div>
    </div>
  </div>
  
</div>
</form>
<!-- main_div -->
<div class="sccg sccg01">
    <div class="sccgtb iconfont"><img src="__IMAGES__/loaddding.gif" style="margin-top:5px" /></div>
    <p>提交中...</p>
  </div>
  <div class="sccg sccg02">
    <div class="sccgtb iconfont"><img src="__IMAGES__/loaddding.gif" style="margin-top:5px" /></div>
    <p>提交中...</p>
  </div>
<!-- footer -->
<include file="Public:foot" />
<!-- footer --> 
<!--统计流量-->
<div style="display:none;">
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1257387489'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s11.cnzz.com/z_stat.php%3Fid%3D1257387489%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</div>
<!--统计流量-->
</body>
<script src="__JS__/jquery.min.js"></script>
<!-- banner -->
<script src="__JS__/swiper.min.js"></script>
<script src="__JS__/layer/layer.js"></script>
<script>

layer.load(1, {
    shade: [0.1,'#fff'] //0.1透明度的白色背景
});


    var swiper = new Swiper('.swiper-container', {
        pagination: '.swiper-pagination',
        paginationClickable: true,
        nextButton: '.swiper-button-next',
        prevButton: '.swiper-button-prev',
        // Enable debugger
        debugger: true
    });
	
	var jiazai_hei=document.body.clientHeight;
$('#jiazai').css('height',jiazai_hei);
	
	$(document).ready(function($){
		$(".overflowH1").click(function(){
		$(".overflowH1").css("background","#ffffff");
		$(".overflowH1 .two_textbox").css("color","#888888");		
		$(this).css("background","#e8e8e8");
		$(this).find('.two_textbox').css("color","#ffffff")	
		$(this).children('input[type=radio]').prop('checked',true);
	})
	
	});	
	
	
	function jia(g){
            var shop_id = g;
			var inid = $("#goodid").val();
			
            $.ajax({
                url: "{:U('/Home/Member/addnums')}",
                type: "post",
                dataType: "json",
                data: {
                    shop_id: shop_id,
					goodid: inid
                }
            }).done(function (e) {
				$("#num"+g).text(e.num);
				$("#nums"+g).val(e.num);
				$("#total_price"+g).text(e.total_price);
				$("#priceall"+g).val(e.total_price);
				$(".qrzf_sl_jg font").text(e.to_price);
				$("#total").val(e.to_price);
            })

        }
		
		function jian(g){
            var shop_id = g;
			var inid = $("#goodid").val();
			
            $.ajax({
                url: "{:U('/Home/Member/decnums')}",
                type: "post",
                dataType: "json",
                data: {
                    shop_id: shop_id,
					goodid: inid
                }
            }).done(function (e) {
				$("#num"+g).text(e.num);
				$("#nums"+g).val(e.num);
				$("#total_price"+g).text(e.total_price);
				$("#priceall"+g).val(e.total_price);
				$(".qrzf_sl_jg font").text(e.to_price);
				$("#total").val(e.to_price);
            })

        }
	
	
	

		
	function coupon_fee1(){
		var total= $("#total").val();
		var coupon_fee= $("#coupon_fee").val();
		var prices=total-coupon_fee;
			$('.qrzf_sl_jg font').text(prices);
		}

    </script>
<!-- banner -->

<script src="__JS__/js.js"></script>
<script type="text/javascript">
  $('.zhifu').click(function(){
	  
    var temp = 1;
    if($('input[name=RadioGroup1]:checked').val()==1){
      if(isNaN($('input[name=storeid]:checked').val())){
        temp = 0;
      }else{
        temp = 1;
      }
    }
    if(temp==1){
      $.ajax({
          url: $('#theForm').attr('action'),
          data: $('#theForm').serialize(),
          type: "post",
          dataType: "json",
		  beforeSend: function() { //开始上传 
					$('#jiazai').show(); //显示加载条
					$('.sccg01').show();
				}, 
      }).done(function (g) {

          if(1==g){
            location.href="{:U('Order/jsapi/type/1')}";
          }else if(g==0){
            alert("生成订单失败");
          }else if(g==2)
		  {
			  alert("收货地址不能为空");
			  window.location.reload();
		  }else if(g==10){
            alert("已售罄");
            $('#jiazai').hide(); //显示加载条
          $('.sccg01').hide();
          }
      });
    }else{
      alert("请选择提货的门店");
    }

  });
  

  $('input[name=RadioGroup1]').click(function(){
    if($(this).val()==1){
      $("#priceall").val($('#newprice2').val());
      $('#showmoney').text($('#newprice2').val());
      $('#yunfei').text(0);
    }else{
      $("#priceall").val($('#newprice').val());
      $('#showmoney').text($('#newprice').val());
      $('#yunfei').text($('input[name=shipping_fee]').val());
    }
   });
  
</script>


<!-- user_yhq2_js -->

<script type="text/javascript">
document.write("<scr"+"ipt src=\"http://api.map.baidu.com/api?v=1.2\"></sc"+"ript>")
document.write("<scr"+"ipt src=\"http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js\"></sc"+"ript>")
</script>

<script src="__JS__/jquery-1.8.3.min.js"></script>
<script src="__JS__/dropdownlist.js"></script>
<script>


var dealerlistcot = {$dealerlistcot},longitude = Array(),latitude = Array(),dealerNum = 0;
var map = new BMap.Map("container");
<?php for($i=0; $i<$dealerlistcot; $i++){ ?>
    longitude[{$i}] = "{$dealerlist.$i.longitude}".split(',');//经度
    latitude[{$i}] = "{$dealerlist.$i.latitude}".split(',');//纬度
    var pts = [];
    for(var j=0; j<longitude[{$i}].length; j++){
      pts.push(new BMap.Point(longitude[{$i}][j],latitude[{$i}][j]));
    }
    var ply = new BMap.Polygon(pts);
    var pt =new BMap.Point("{$xz}", "{$yz}"); 
    var result = BMapLib.GeoUtils.isPointInPolygon(pt, ply);
    if(result == true){
      dealerNum = 1;
        $('#dealerNum').val({$i});
    }
<?php } ?>
$.ajax({
  url:"{:U('Home/Order/ajaxyunfeigorder')}",
  type:"post",
  async:false,
  data:{dealerNum:$('#dealerNum').val(),goodid:$('#goodid').val()},
  success:function(ret){
    layer.closeAll();
    $('#yunfei').text(ret);
    $('#yunfei2').text(ret);
    $('#yunfei2').val(ret);
  }
});

  var mon = parseFloat($('#newprice_2').val())+parseFloat($('#yunfei2').val());
$(function(){
  if($('input[name=RadioGroup1]:eq(0)').prop('checked')){
    $('input[name=RadioGroup1]:eq(0)').click();
  }
   $('input[name=RadioGroup1]').click(function(){
    if($(this).val()==1){
      $('#showmoney').text($('#newprice2').val());
      $('#yunfei').text(0);
      $("#priceall").val($('#newprice2').val());
    }else{
        $('#showmoney').text(mon);
        $('#yunfei').text($('#yunfei2').val());
        $("#priceall").val(mon);
      
    }
   });

    // 通过原生select控件创建自定义下拉框
    var ddl_picture = DropDownList.create({
        select:$('#demo2'),
        attrs:{
            column :5,
            width :200,
			
        }
    });
	ddl_picture.change(function(){
		//alert(ddl_picture.val());
	});
});  
//if(dealerNum==1){
  $('#showmoney').text(mon);
  $('#yunfei').text($('#yunfei2').val());
  $("#priceall").val(mon);
  $("#shipping_fee").val($('#yunfei2').val());
//}  
</script>
<!-- user_yhq2_js -->
</html>